package com.example.tusha.micromaxtv;

import android.os.Build;
import android.support.annotation.RequiresApi;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.hardware.ConsumerIrManager;
import android.view.View;
import android.widget.ImageButton;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class MainActivity extends AppCompatActivity {

    private final static String CMD_TV_POWER =
           // "0000 006E 0000 0000 00A9 00A9 0016 003E 0016 0014 0016 003E 0016 003E 0016 0014 0016 0014 0016 003E 0016 0014 0016 0014 0016 003E 0016 0014 0016 0014 0016 003E 0016 003E 0016 0014 0016 003E 0016 0014 0016 0014 0016 0014 0016 003E 0016 003E 0016 003E 0016 003E 0016 003E 0016 003E 0016 003E 0016 003E 0016 0014 0016 0014 0016 0014 0016 0014 0016 0014 0016 003E 0016 0014 0016 003E 0016 003E 0016 003E 0016 0014 0016 0014 0016 0014 0016 0014 0016 003E 0016 0014 0016 0014 0016 0014 0016 003E 0016 003E 0016 003E 0016 00C92 0000 00A9 00A9 0016 003E 0016 0014 0016 003E 0016 003E 0016 0014 0016 0014 0016 003E 0016 0014 0016 0014 0016 003E 0016 0014 0016 0014 0016 003E 0016 003E 0016 0014 0016 003E 0016 0014 0016 0014 0016 0014 0016 003E 0016 003E 0016 003E 0016 003E 0016 003E 0016 003E 0016 003E 0016 003E 0016 0014 0016 0014 0016 0014 0016 0014 0016 0014 0016 003E 0016 0014 0016 003E 0016 003E 0016 003E 0016 0014 0016 0014 0016 0014 0016 0014 0016 003E 0016 0014 0016 0014 0016 0014 0016 003E 0016 003E 0016 003E 0016 00C92";
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0607 0024 0185 0015 0E31 0154 0055 0015 0E31 0154 0055 0015 29CC";
    private final static String CMD_TV_SOURCE =
            "0000 006E 0000 0000 0153 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0040 0015 29CC";
    private final static String CMD_TV_CH_NEXT =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 000F 0047 0015 0040 0015 0016 000F 0047 0011 001A 000B 004A 000F 0047 0010 001B 000A 0021 0009 0022 0009 004C 000E 001D 0009 004C 000E 001D 0009 0022 0008 004D 000F 0047 000F 0047 000E 060E 0014 0195 0014 29CC";
    private final static String CMD_TV_CH_PREV =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0040 0015 0607 0154 0055 0015 0E30 0154 0055 0015 29CC";
    private final static String CMD_TV_BACK =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0607 0154 0055 0015 0E31 0154 0055 0015 29CC";
    private final static String CMD_TV_LEFT =
            "0000 006E 0000 0000 0157 00AA 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 003F 0016 003F 0016 003F 0016 003F 0016 003F 0016 0016 0016 003F 0016 003F 0016 003F 0016 003F 0016 003F 0016 0016 0016 0016 0016 0016 0016 003F 0016 0016 0016 0016 0016 0016 0016 0016 0016 003F 0016 003F 0016 003F 0016 0016 0016 003F 0016 05FD 0171 0054 0017 29CC";
    private final static String CMD_TV_RIGHT =
            "0000 006E 0000 0000 003B 01C4 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0013 0042 0013 0042 0013 0042 0013 0042 0013 0042 0015 0016 0013 0042 0013 0042 0013 0042 0013 0042 0013 0042 0015 0016 0015 0016 0011 001A 0011 001A 0011 001A 0011 001A 0011 001A 0011 001A 000F 0047 0013 0042 0013 0042 0013 0042 0013 0042 0015 0607 0019 0190 0014 0E31 0025 0184 0015 0E30 0154 0055 0015 29CC";
    private final static String CMD_TV_UP =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 000F 0047 0015 0040 0015 0016 000F 0047 0011 001A 000B 004A 000F 0047 0010 001B 000A 0021 0009 0022 0009 004C 000E 001D 0009 004C 000E 001D 0009 0022 0008 004D 000F 0047 000F 0047 000E 060E 0014 0195 0014 29CC";
    private final static String CMD_TV_DOWN =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0040 0015 0607 0154 0055 0015 0E30 0154 0055 0015 29CC";
    private final static String CMD_TV_ENTER =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0608 0154 0055 0015 29CC";
    private final static String CMD_TV_NO1 =
            "0000 006E 0000 0000 0153 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0040 0015 0016 0015 0040 0015 0016 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0040 0015 0016 0015 0040 0015 0016 0015 0040 0015 0607 0153 0055 0015 0E30 0153 0055 0015 29CC" ;
    private final static String CMD_TV_NO2 =
            "0000 006B 0000 0000 0001 0056 0003 0029 0002 0055 0008 004F 000E 001E 000F 0048 0015 0016 0015 0016 0015 0016 0015 0042 0015 0016 0015 0016 0015 0042 0015 0016 0015 0042 0015 0042 0015 0042 0015 0627 015B 0057 0015 0E7B 015B 0057 0015 2AAB" ;
    private final static String CMD_TV_NO3 =
            "0000 006E 0000 0000 0153 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0016 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0607 0153 0055 0015 0E30 0153 0055 0015 29CC" ;
    private final static String CMD_TV_NO4 =
            "0000 006E 0000 0000 0153 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0016 0015 0040 0015 0606 0153 0055 0015 0E2F 0153 0055 0015 29CC";
    private final static String CMD_TV_NO5 =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0010 001B 0010 001B 000D 0048 0012 0043 000D 0048 000D 0048 000D 0048 000C 001F 0006 0050 000D 0048 000A 0021 0005 0050 0009 004C 0009 004C 000A 0021 0005 0026 0004 0027 0004 0027 0005 0050 000C 001F 0007 0024 0007 0024 0008 004E 000D 0048 0014 0041 0015 0041 0015 0607 0154 0055 0015 0E30 0154 0055 0015 29CC" ;
    private final static String CMD_TV_NO6 =
            "0000 006E 0000 0000 0153 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0607 0153 0055 0015 0E30 0153 0055 0015 29CC" ;
    private final static String CMD_TV_NO7 =
            "0000 006E 0000 0000 0153 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0040 0015 0040 0015 0016 0015 0040 0015 0606 0153 0055 0015 29CC" ;
    private final static String CMD_TV_NO8 =
            "0000 006E 0000 0000 0153 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0011 0045 000E 001D 0009 004C 0009 004C 0007 0024 0004 0051 0004 0051 0002 192F" ;
    private final static String CMD_TV_NO9 =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0607 0153 0055 0015 0E30 000C 019D 0007 29CC" ;
    private final static String CMD_TV_NO0 =
            "0000 006E 0000 0000 000D 01F1 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0606 0153 0055 0015 0E2F 0153 0055 0015 29CC" ;
    private final static String CMD_TV_VOLPLUS =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0040 0015 0040 0015 0016 0015 0040 0015 0607 0154 0055 0015 29CC";
    private final static String CMD_TV_VOLMINUS =
            "0000 006E 0000 0000 0154 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0016 0015 0040 0015 0607 0154 0055 0015 29CC";
    private final static String CMD_TV_MENU =
            "0000 006E 0000 0000 0153 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0016 0015 0040 0015 0040 0015 0040 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0607 0153 0055 0015 29CC";
    private final static String CMD_TV_DOUBLE =
            "0000 006E 0000 0000 0153 00AB 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0040 0015 0040 0015 0016 0015 0016 0015 0016 0015 0016 0015 0016 0015 0040 0015 0016 0015 0016 0015 0040 0015 0040 0015 0040 0015 0040 0015 0040 0015 0016 0015 0040 0015 0607 0153 0055 0015 0E31 0153 0055 0015 29CC";
    private final static String CMD_TV_MUTE =
            "0000 0072 0000 0000 0014 003E 0014 003E 0014 003E 0014 003E 0015 0014 0014 003E 0014 003E 0015 0014 0014 003E 0015 0014 0015 0014 0015 0014 0015 0014 0014 003E 0015 0014 0014 003E 0015 0014 0014 003E 0014 003E 0014 003E 0014 003E 0015 0014 0014 003E 0016 05BB 0157 0051 0016 0E99";

    private ConsumerIrManager irManager;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        irManager = (ConsumerIrManager) getSystemService(CONSUMER_IR_SERVICE);

        findViewById(R.id.imgButtonpower).setOnClickListener(new ClickListener(hex2ir(CMD_TV_POWER)));
        findViewById(R.id.imgButtonsource).setOnClickListener(new ClickListener(hex2ir(CMD_TV_SOURCE)));
        findViewById(R.id.imgButtonchplus).setOnClickListener(new ClickListener(hex2ir(CMD_TV_CH_NEXT)));
        findViewById(R.id.imgButtonchminus).setOnClickListener(new ClickListener(hex2ir(CMD_TV_CH_PREV)));
        findViewById(R.id.imgButtonback).setOnClickListener(new ClickListener(hex2ir(CMD_TV_BACK)));
        findViewById(R.id.imgButtonleft).setOnClickListener(new ClickListener(hex2ir(CMD_TV_LEFT)));
        findViewById(R.id.imgButtonback).setOnClickListener(new ClickListener(hex2ir(CMD_TV_UP)));
        findViewById(R.id.imgButtonleft).setOnClickListener(new ClickListener(hex2ir(CMD_TV_DOWN)));
        findViewById(R.id.imgButtonright).setOnClickListener(new ClickListener(hex2ir(CMD_TV_RIGHT)));
        findViewById(R.id.imgButtonok).setOnClickListener(new ClickListener(hex2ir(CMD_TV_ENTER)));
        findViewById(R.id.imgButton1).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO1)));
        findViewById(R.id.imgButton2).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO2)));
        findViewById(R.id.imgButton3).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO3)));
        findViewById(R.id.imgButton4).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO4)));
        findViewById(R.id.imgButton5).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO5)));
        findViewById(R.id.imgButton6).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO6)));
        findViewById(R.id.imgButton7).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO7)));
        findViewById(R.id.imgButton8).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO8)));
        findViewById(R.id.imgButton9).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO9)));
        findViewById(R.id.imgButton0).setOnClickListener(new ClickListener(hex2ir(CMD_TV_NO0)));
        findViewById(R.id.imgButtonplus).setOnClickListener(new ClickListener(hex2ir(CMD_TV_VOLPLUS)));
        findViewById(R.id.imgButtonminus).setOnClickListener(new ClickListener(hex2ir(CMD_TV_VOLMINUS)));
        findViewById(R.id.imgButtonmenu).setOnClickListener(new ClickListener(hex2ir(CMD_TV_MENU)));
        findViewById(R.id.imgButtondouble).setOnClickListener(new ClickListener(hex2ir(CMD_TV_DOUBLE)));
        findViewById(R.id.imgButtonmute).setOnClickListener(new ClickListener(hex2ir(CMD_TV_MUTE)));
    }

    private IRCommand hex2ir(final String irData) {
        List<String> list = new ArrayList<String>(Arrays.asList(irData.split(" ")));
        list.remove(0); // dummy
        int frequency = Integer.parseInt(list.remove(0), 16); // frequency
        list.remove(0); // seq1
        list.remove(0); // seq2

        frequency = (int) (1000000 / (frequency * 0.241246));
        int pulses = 1000000 / frequency;
        int count;

        int[] pattern = new int[list.size()];
        for (int i = 0; i < list.size(); i++) {
            count = Integer.parseInt(list.get(i), 16);
            pattern[i] = count * pulses;
        }

        return new IRCommand(frequency, pattern);
    }

    private class ClickListener implements View.OnClickListener {
        private final IRCommand cmd;

        public ClickListener(final IRCommand cmd) {
            this.cmd = cmd;
        }

        @Override
        public void onClick(final View view) {
            android.util.Log.d("Remote", "frequency: " + cmd.freq);
            android.util.Log.d("Remote", "pattern: " + Arrays.toString(cmd.pattern));
            irManager.transmit(cmd.freq, cmd.pattern);
        }
    }

    class IRCommand {
        private final int freq;
        private final int[] pattern;

         private IRCommand(int freq, int[] pattern) {
            this.freq = freq;
            this.pattern = pattern;
         }
    }
}
